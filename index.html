<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>School System</title>

<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.card{background:white;padding:15px;margin:10px;border-radius:10px}
table{border-collapse:collapse;width:100%}
td,th{border:1px solid #aaa;padding:5px;text-align:center}
input{width:45px}
</style>
</head>

<body>

<h1>üè´ School System</h1>

<div class="card" id="home">
<input id="uid" placeholder="Student ID / Admin">
<button onclick="login()">Login</button>
</div>

<div id="admin" style="display:none" class="card"></div>
<div id="student" style="display:none" class="card"></div>

<script>

const ADMIN="9999"

const subjects=[
"Thai","Math","Science","English","Social",
"Health","Art","Music","PE","Computer",
"Chinese","Project","Activity"
]

let students=JSON.parse(localStorage.getItem("stu"))||[
{id:"41235",name:"Student1",work:Array(13).fill(0),exam:Array(13).fill(0)},
{id:"43821",name:"Student2",work:Array(13).fill(0),exam:Array(13).fill(0)}
]

function save(){localStorage.setItem("stu",JSON.stringify(students))}

function grade(x){
if(x>=80)return"A"
if(x>=70)return"B"
if(x>=60)return"C"
if(x>=50)return"D"
return"F"
}

function gpa(g){return{A:4,B:3,C:2,D:1,F:0}[g]}

function total(w,e){return w*0.7+e*0.3}

function login(){
let id=uid.value
if(id==ADMIN){home.style.display="none";admin.style.display="block";renderAdmin();return}
let s=students.find(x=>x.id==id)
if(s){home.style.display="none";student.style.display="block";renderStudent(s)}
}

function renderAdmin(){

let html="<h2>ADMIN PANEL</h2><table><tr><th>Name</th>"

subjects.forEach(x=>html+=`<th>${x}</th>`)

html+="<th>GPA</th></tr>"

students.forEach((s,i)=>{
let sum=0
html+=`<tr><td>${s.name}</td>`
subjects.forEach((_,j)=>{
let t=total(s.work[j],s.exam[j])
let g=grade(t)
sum+=gpa(g)
html+=`<td>
W<input value="${s.work[j]}" onchange="edit(${i},${j},0,this.value)">
E<input value="${s.exam[j]}" onchange="edit(${i},${j},1,this.value)">
<br>${g}
</td>`
})
html+=`<td>${(sum/13).toFixed(2)}</td></tr>`
})

html+="</table><button onclick='ranking()'>‡∏î‡∏π Ranking</button>"

admin.innerHTML=html
save()
}

function edit(i,j,t,v){
t==0?students[i].work[j]=+v:students[i].exam[j]=+v
renderAdmin()
}

function ranking(){
students.sort((a,b)=>{
return calc(b)-calc(a)
})
renderAdmin()
}

function calc(s){
let sum=0
for(let i=0;i<13;i++)sum+=gpa(grade(total(s.work[i],s.exam[i])))
return sum
}

function renderStudent(s){
let html=`<h2>${s.name}</h2><table><tr>`
subjects.forEach(x=>html+=`<th>${x}</th>`)
html+="</tr><tr>"
let sum=0
subjects.forEach((_,i)=>{
let t=total(s.work[i],s.exam[i])
let g=grade(t)
sum+=gpa(g)
html+=`<td>${t.toFixed(0)}<br>${g}</td>`
})
html+=`</tr></table><h3>GPA ${(sum/13).toFixed(2)}</h3>`
student.innerHTML=html
}

</script>
</body>
</html>